@extends(main, pageTitle: page.capFirst())
@args String page, String html
@set(bodyClass: "doc")
@set(title: page)
@section(moreStyles) {
    <link href="/public/css/prettify.css" type="text/css" rel="stylesheet" />
    <style type="text/css">
        h3 {
            margin: 40px 0px 20px;
            background-color: #e4e9ee;
            font-size: 12pt;
            padding: 10px;
            line-height: 15px;
        }
        p {margin-top: 20px; margin-bottom: 10px; font-size: 14pt;}
        footer p {font-size: 12pt;}
        .main.container ul li, .main.container ol li {
            font-size: 13pt;
            margin-bottom: 10px;
        }
        pre {background-color: #000;}
        pre > code * {font-size: 10pt;line-height: 16px;}
        section {
            padding-top: 20px;
        }
        #doc-nav {
        @ifNot("zh".equals(lang)) {
            font-family: Arial, Sans;
        }
            width: 200px;
        }
        iframe {
            width: 100%;
            min-height: 220px;
            border: 1px solid #eee;
        }
    </style>
}
@section(moreScripts){
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/prettify/r224/prettify.js"></script>
    <script type="text/javascript">
        $(function(){
            document.domain = location.host.replace(/^.*?([^.]+\.[^.]+)$/g,'$1');
            $('pre code').each(function() {
                var $me = $(this);
                if (!$me.hasClass('prettyprint')) {
                    $me.addClass('prettyprint linenums');
                } else {
                    $me.addClass('linenums'); 
                }
            });
            prettyPrint();
            
            var names = {
                h2: 0,
                h3: 0,
                h4: 0
            };
            
            // set anchor for all headers
            var r = /^\s*\[(.*)\](.*)/;
            $('#doc-content > h2, #doc-content > h3, #doc-content > h4, #doc-content > h5').each(function(){
                var $h = $(this), s = $h.text(), v = r.exec(s), id = false;
                if (v) {
                    id = v[1];
                    $h.text(' ' + v[2]);
                } else {
                    var nm = this.tagName.toLowerCase();
                    id = nm + "_" + names[nm]++;
                }
                 
                //$('<a id="' + nm0 + '"></a>').prependTo($h);
                $h.wrap($('<section></section>').prop('id', id).addClass(this.tagName.toLowerCase()));
            });
            
            // construct navigation for named anchors
            $('#doc-content section[id]').each(function(){
                if (!$(this).hasClass('h3')) return;
                var $a = $(this), nm = $a.prop('id'), lbl = $a.text();
                if (!lbl) {
                    lbl = $a.parent().text();
                }
                if (!lbl) {
                    lbl = $a.next().text();
                }
                if (lbl) {
                    $('<li><a href="#' + nm + '"><i class="icon-angle-right"></i> ' + lbl + '</li>').appendTo('#doc-nav');
                }
            });
            
            $('.affix').affix();
            
            // at last start embedded video if there is
            $('iframe').each(function(){
                $me = $(this), src = $me.data('src');
                if (src) {
                    src = src.replace(/\s+/g, '');
                    $me.attr('src', src);
                    var r = /.*\/embed\/([0-9a-z]*).*/g, m = r.exec(src);
                    $me.attr('data-id', m[1]);
                }
            })
            
            $('body').bind('_resize', function(evt){
                $('iframe[data-id=' + evt.id + "]").height(event.h);
            })
        })
    </script>
}

@init() {
    if (page.startsWith("feature")) super.__setRenderArg("curPage", "feature");
    else super.__setRenderArg("curPage", "doc");
}

<div class="row">
    <div class="span3" id="nav-box">
        <div class="affix">
            <ul class="nav nav-list" id="doc-nav">
            </ul>
            <div style="margin: 20px auto;font-size: 9pt; width:157px;padding-right: 14px;" class="alert">
                @msg("load.found-bug")
                <br/>
                <a target="_blank" href="https://github.com/greenlaw110/rythm-doc/issues" style="color: #38a">
                    <i class="icon-github"></i>
                    @msg("load.report-bug")
                </a>
            </div>
        </div>
    </div>
    <div class="span9" id="doc-content">
        @html.raw()
    </div>
</div>

<div>
</div>
